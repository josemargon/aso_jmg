# PR0205: Programación de tareas con cron

## ¿Qué orden pondrías en crontab en los siguientes casos?
   
- La tarea se ejecuta cada hora.
  
  `0 * * * *`

- La tarea se ejecuta los domingos cada 3 horas.
  
  `0 */3 * * 0`

- La tarea se ejecuta a las 12 de la mañana los días pares del mes.

  `0 12 2-30/2 * *`

- La tarea se ejecuta el primer día de cada mes a las 8 de la mañana y a las 8 de la tarde.

  ```
  0 8 1 * *
  
  0 20 1 * *
  ```

- La tarea se ejecuta cada media hora de lunes a viernes.
  
  `*/30 * * * 1-5`

- La tarea se ejecuta cada cuarto de hora, entre las 3 y las 8, de lunes a viernes, durante todo el mes de agosto.
  
  `*/15 3-8 * 8 1-5`

- La tarea se ejecuta cada 90 minutos
  
  ```
  0 */3 * * *

  30 1-23/3 * * *
  ```

## ¿Cómo compruebas si el servicio cron se está ejecutando?

Con el comando `sudo systemctl status cron`.

## ¿Cuál es el efecto de la siguiente línea crontab?

`*/15 1,2,3 * * * who > /tmp/test`

Esta línea de crontab ejecutará el comando who cada 15 minutos entre la 1:00 AM y las 3:59 AM, todos los días y todos los meses, y guardará la salida en el archivo /tmp/test, sobrescribiéndolo en cada ejecución.

## Indica la ruta del fichero crontab del sistema

/etc/crontab

## ¿Qué ficheros controlan los usuarios que pueden utilizar el crontab?

`/etc/cron.allow` Indica que usuarios pueden usar crontab.

`/etc/cron.deny` Indica que usuarios no pueden usar crontab.

## Excepcionalmente se debe iniciar una tarea llamada script.sh todos los lunes a las 07:30h antes de entrar en clase ¿Cómo lo harías?

30 7 * * 1 ./script.sh

## Se ha cancelado la tarea. ¿Cómo listar y luego, suprimir la tarea?

`crontab -l` Para listar las tareas de crontab.

Para eliminar la tarea podemos hacer `crontab -e` para eliminarla manualmente o `crontab -r` y eliminar todas las tareas del fichero crontab.

## Ejecuta el comando ps -ef para el usuario root cada 2 minutos y redirecciona el resultado a /tmp/ps_result sin sobrescribir los antiguos.

sudo crontab -e

`*/2 * * * * ps -ef >> /tmp/ps_result`

## Verifica la lista de tareas en crontab

`crontab -l` o `sudo crontab -l root`

## Espera unos minutos y comprueba el resultado en /tmp

Si ponemos `ls /tmp` vemos que el fichero ps_result existe y con un `cat /tmp/ps_result` veremos su contenido.

## Crea el usuario asir2 y prohíbele utilizar el crontab.

`sudo useradd asir2` para crear el usuario y añadimos el usuario en `sudo nano /etc/cron.deny`.

## Verifica que el usuario asir2 realmente no puede utilizar crontab

Para verificar que asir2 no puede usar crontab, iniciamos sesion en asir2 y ponemos crontab -e.

## Programa crontab para que cada día a las 0:05 se eliminen todos los ficheros que se encuentran en el directorio /tmp.

`crontab -e`

`5 0 * * * rm -rf /tmp/*`

## Programa una tarea en el sistema que se lance de lunes a viernes a las 9 de la mañana durante los meses de verano (julio, agosto y septiembre) que escriba en un fichero la hora actual (comando date, aunque tienes que mirar la ayuda para elegir un formato comprensible) seguido del listado de usuarios que hay conectados en ese momento en el sistema (comando who)

`0 9 * 7-9 1-5 date +"%H:%M:%S"; who >> /home/Desktop/usuarios_contectados`

##  El servicio cron se ayuda de una serie de ficheros y directorios que se encuentran en el directorio /etc. Explica la función de cada uno de los siguientes ficheros/directorios:

- cron.d: /etc/cron.d/: Directorio donde se almacenan archivos de cron para tareas específicas de aplicaciones o servicios. Contiene configuraciones de cron con sintaxis similar a crontab.

- cron.allow: Archivo que lista los usuarios permitidos para usar crontab. Si existe, solo esos usuarios pueden programar tareas cron.

- cron.deny: Archivo que lista los usuarios a los que se les prohíbe usar crontab. Si cron.allow no existe, se utiliza este.

- cron.daily: Directorio con scripts que se ejecutan diariamente.

- cron.hourly: Directorio con scripts que se ejecutan cada hora.

- cron.monthly: Directorio con scripts que se ejecutan una vez al mes.

### [Indice anterior](../indexT2.md) 