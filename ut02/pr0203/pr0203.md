# PR0203: Conexion SSH entre redes

## Preparación de las máquinas

Para esta práctica crearemos 3 máquinas virtuales de UbuntuServer que identificaremos de la siguiente manera.

Server-A -> Usuario Jose, Hostname server-a
Server-B -> Usuario sysadmin, Hostname server-b
Server-C -> Usuario sysadmin, Hostname server-c

En VirtualBox estableceremos las siguientes interfaces de red para cada máquina.

- El Server-A tendrá 1 adaptador de red NAT y 3 adaptadores solo anfitrión.

- El Server-B y Server-C tendrán un adaptador NAT y un adaptador solo anfitrión.

Durante la instalación de los SO sleccionamos `Instalar servidor OpenSSH`

## Configuración de las redes

### Server-A

Primero hacemos `ip a` para ver que interfaces tenemos, para modificar la configuración modificamos el archivo `50-cloud-init.yaml`, situado en `/etc/netplan`

En este archivo especificamos la ip que queremos asignarle, en este caso a la interfaz solo anfitrión.

```
enp0s8:
    addresses:
        - 192.168.56.101/24
enp0s9:
    addresses:
        - 10.20.0.10/16
enp0s10:
    addresses:
        - 10.30.0.10/16
```

Para aplicar la configuración escribimos `sudo netplan apply`.

Ahora al realizar de nuevo un ip a vemos como se ha aplicado correctamente la nueva ip asignada.

### Server-B

Repetimos el proceso para configurar las ip.

```
enp0s8:
    addresses:
        - 10.20.0.10/16
```

Con la red configurada, deberíamos poder hacer un ping desde el Server-A al Server-B pero no desde la anfitriona al Server-B

### Server-C

Repetimos de nuevo la configuración de interfaces.

```
enp0s8:
    addresses:
        - 10.30.0.10/16
```

De nuevo, con esto configurado, podríamos hacer ping entre el Server-A al Server-C pero no podríamos desde la anfitriona.

## Claves SSH

### Anfitriona

Desde la terminal de la máquina anfitriona escribimos `ssh-keygen` para crear la clave ssh.

Con el comando `scp` copiamos la clave.

`scp .\.ssh\id_ed25519.pub jose@192.168.56.101`

### Server-A

Ahora desde Server-A movemos la cláve que acabamos de crear a `.ssh/authorized_keys`.

`cat id_25519.pub >> .ssh/authorized_keys`

Ahora, al conectarnos por ssh entre la anfitriona y Server-A no nos pedirá la contraseña.

Ahora generamos la clave ssh de Server-A.

`ssh-keygen -b 1024`

Y al igual que entre la anfitriona y Server-A, copiamos la clave ssh en los Server-B y Server-C

```
scp .\.ssh\id_ed25519.pub sysadmin@10.20.0.20
scp .\.ssh\id_ed25519.pub sysadmin@10.30.0.20
```

### Server-B y Server-C

Por último, tanto en Server-B como en Server-C metemos la clave de Server-A a su carpeta correspondiente.

`cat id_25519.pub >> .ssh/authorized_keys`

Para comprobar que la practica ha funcionado correctamente, al intentar conectarnos por ssh desde la anfitriona a los Server-B y Server-C podremos conectarnos y no nos pedirá contraseña.

### [Indice anterior](../indexT2.md) 