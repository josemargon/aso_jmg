# pr0607

## Objetivo

Trabajas como Administrador de Sistemas en la empresa TechIberia S.L.. El departamento de Recursos Humanos utiliza una aplicación antigua para registrar a las nuevas incorporaciones.

Cada lunes, RRHH te envía un fichero de texto plano con los datos de los nuevos empleados. Lamentablemente, el formato de salida de su aplicación es caótico: todo está en mayúsculas, los delimitadores son extraños y los campos están mezclados.

Tu objetivo es crear un script en PowerShell que lea estos datos “sucios”, los procese utilizando manipulación de cadenas y exporte un archivo CSV limpio y profesional listo para ser importado a Active Directory o Microsoft 365.

## Datos de entrada

Crea un fichero llamado nuevos_empleados_raw.txt con el siguiente contenido exacto (copia y pega):

```
GARCIA LOPEZ, ANA MARIA|MAD-VENTAS-01|1995/05/12
RUIZ DE LA TORRE, PEDRO|BCN-IT_SOPORTE-02|1988/11/23
O'CONNOR, SARAH JANE|BIO-MARKETING-05|2001/02/15
MARTINEZ, JOSE|SEV-LOGISTICA-09|1999/12/30
```

## Requerimientos técnicos

- Nombre y apellidos:
    - El formato original es APELLIDOS, NOMBRE en mayúsculas.
    - Debes separarlos y convertirlos a Title Case (primera letra mayúscula, resto minúscula).
    - Ejemplo: “Ana Maria Garcia Lopez”.
- Generación de nombre de usuario (SAMAccountName):
    - Debe formarse con: la primera letra del nombre + las primeras 6 letras del primer apellido.
    - Todo en minúsculas.
    - Si el apellido tiene menos de 6 letras, no debe dar error, debe coger las que tenga.
- Generación de correo electrónico:
    - Formato: nombre.apellido@techiberia.com.
    - Si el nombre o apellido es compuesto, reemplaza los espacios por puntos (ej: ana.maria.garcia.lopez@techiberia.com).
- Departamento y ubicación:
    - El código original es CIUDAD-DEPARTAMENTO-ID.
    - Debes extraer solo el nombre del departamento (lo que está en el medio).
    - Debes limpiar el texto (ej: convertir IT_SOPORTE a It Soporte o simplemente IT_SOPORTE, pero sin la ciudad ni el ID).
- Contraseña temporal:
    - Debe ser la palabra ChangeMe + el año de nacimiento + el símbolo !.
    - Para esto necesitas extraer el año de la fecha proporcionada.

## Script

```
$datosUsuarios = Get-Content -Path "G:\ps\nuevos_empleados_raw.txt"

$objetos = foreach ($linea in $datosUsuarios) {

    $partes = $linea.Split("|")

    $nombre = $partes[0].Split(",")[1].Trim()
    $apellidos = $partes[0].Split(",")[0].Trim()

    $nombreCompleto = $nombre + " " + $apellidos
    $nombreCompleto = ($nombreCompleto -split ' ' | ForEach-Object { $_.Substring(0,1).ToUpper() + $_.Substring(1).ToLower() }) -join ' '

    $limpioNombre = ($nombre -replace "[^a-zA-Z]","")
    $limpioApellidos = ($apellidos -replace "[^a-zA-Z]","")

    $primerApellido = $apellidos.Split(" ")[0] -replace "[^a-zA-Z]",""
    if($primerApellido.Length > 6) {
        $SamAccountName = (
            $limpioNombre.Substring(0,1) +
            $limpioApellidos.Substring(0,5)
        ).ToLower()
    } else {
        $SamAccountName = (
            $limpioNombre.Substring(0,1) +
            $primerApellido 
        ).ToLower()
    }
   
    $correo = (
        (($nombreCompleto.Split(" ") | ForEach-Object { $_ -replace "[^a-zA-Z]"}) -join '.') +
        "@techiberia.com"
    ).ToLower()

    $departamento = $partes[1].Split("-")[1].Replace("_"," ").Trim()

    $anhoNacimiento = $partes[2].Split("/")[0].Trim()
    $pass = "ChangeMe" + $anhoNacimiento + "!"

    [PSCustomObject] @{
        NombreCompleto  =   $nombreCompleto
        Usuario         =   $SamAccountName
        Email           =   $correo
        Departamento    =   $departamento
        PasswordInicial =   $pass
    }

}

$objetos | Export-Csv -Path "uusarios_importar.csv"
$objetos | Format-Table -AutoSize
```

## Resultado

```
NombreCompleto         Usuario   Email                                 Departamento PasswordInicial
--------------         -------   -----                                 ------------ ---------------
Ana Maria Garcia Lopez agarcia   ana.maria.garcia.lopez@techiberia.com VENTAS       ChangeMe1995!
Pedro Ruiz De La Torre pruiz     pedro.ruiz.de.la.torre@techiberia.com IT SOPORTE   ChangeMe1988!
Sarah Jane O'connor    soconnor  sarah.jane.oconnor@techiberia.com     MARKETING    ChangeMe2001!
Jose Martinez          jmartinez jose.martinez@techiberia.com          LOGISTICA    ChangeMe1999!
```