# pr0607

## Objetivo

Trabajas como Administrador de Sistemas en la empresa TechIberia S.L.. El departamento de Recursos Humanos utiliza una aplicación antigua para registrar a las nuevas incorporaciones.

Cada lunes, RRHH te envía un fichero de texto plano con los datos de los nuevos empleados. Lamentablemente, el formato de salida de su aplicación es caótico: todo está en mayúsculas, los delimitadores son extraños y los campos están mezclados.

Tu objetivo es crear un script en PowerShell que lea estos datos “sucios”, los procese utilizando manipulación de cadenas y exporte un archivo CSV limpio y profesional listo para ser importado a Active Directory o Microsoft 365.

## Datos de entrada

Crea un fichero llamado nuevos_empleados_raw.txt con el siguiente contenido exacto (copia y pega):

```
GARCIA LOPEZ, ANA MARIA|MAD-VENTAS-01|1995/05/12
RUIZ DE LA TORRE, PEDRO|BCN-IT_SOPORTE-02|1988/11/23
O'CONNOR, SARAH JANE|BIO-MARKETING-05|2001/02/15
MARTINEZ, JOSE|SEV-LOGISTICA-09|1999/12/30
```

## Requerimientos técnicos

- Nombre y apellidos:
    - El formato original es APELLIDOS, NOMBRE en mayúsculas.
    - Debes separarlos y convertirlos a Title Case (primera letra mayúscula, resto minúscula).
    - Ejemplo: “Ana Maria Garcia Lopez”.
- Generación de nombre de usuario (SAMAccountName):
    - Debe formarse con: la primera letra del nombre + las primeras 6 letras del primer apellido.
    - Todo en minúsculas.
    - Si el apellido tiene menos de 6 letras, no debe dar error, debe coger las que tenga.
- Generación de correo electrónico:
    - Formato: nombre.apellido@techiberia.com.
    - Si el nombre o apellido es compuesto, reemplaza los espacios por puntos (ej: ana.maria.garcia.lopez@techiberia.com).
- Departamento y ubicación:
    - El código original es CIUDAD-DEPARTAMENTO-ID.
    - Debes extraer solo el nombre del departamento (lo que está en el medio).
    - Debes limpiar el texto (ej: convertir IT_SOPORTE a It Soporte o simplemente IT_SOPORTE, pero sin la ciudad ni el ID).
- Contraseña temporal:
    - Debe ser la palabra ChangeMe + el año de nacimiento + el símbolo !.
    - Para esto necesitas extraer el año de la fecha proporcionada.

## Script

```
$datosUsuarios = Get-Content "nuevos_empleados_raw.txt"

$resultado = foreach($lineas in $datosUsuarios){

    $partes = $lineas.split("|")

    $nombre = $partes[0].split(",")[1].trim()
    $apellido = $partes[0].split(",")[0].trim()
    $nombreCompleto = $nombre + " " + $apellido
    $nombreCompleto = (Get-Culture).TextInfo.ToTitleCase($nombreCompleto.ToLower())

    $priApellido = $apellido.split(" ")[0]
    if ( $priApellido.Length > 6 ){
        $usuario = $nombre.SubString(0,1) + $apellido.SubString(0,5)
    } else{
        $usuario = $nombre.SubString(0,1) + $priApellido
    }
    $usuario = $usuario.ToLower()

    $email = $nombre + "." + $apellido + "@techiberia.com"
    $email = $email.Replace(" ",".")

    $departamento = $partes[1].split("-")[1].trim()

    $ano = $partes[2].split("/")[0].trim()
    $contrasena = "ChangeMe" + $ano + "!"

    [PSCustomObject] @{
        NombreCompleto  =   $nombreCompleto
        Usuario         =   $usuario
        Email           =   $email
        Departamento    =   $departamento
        PasswordInicial =   $contrasena
    }
}

$resultado | Export-Csv -Path "usarios_importar.csv"
$resultado | Format-Table -AutoSize
```

## Resultado

```
NombreCompleto         Usuario   Email                                 Departamento PasswordInicial
--------------         -------   -----                                 ------------ ---------------
Ana Maria Garcia Lopez agarcia   ana.maria.garcia.lopez@techiberia.com VENTAS       ChangeMe1995!
Pedro Ruiz De La Torre pruiz     pedro.ruiz.de.la.torre@techiberia.com IT SOPORTE   ChangeMe1988!
Sarah Jane O'connor    soconnor  sarah.jane.oconnor@techiberia.com     MARKETING    ChangeMe2001!
Jose Martinez          jmartinez jose.martinez@techiberia.com          LOGISTICA    ChangeMe1999!
```