# pr0606

## Objetivo

Eres el responsable de infraestructura de una plataforma de E-Commerce. Un sistema de inventario de hace 10 años está registrando los movimientos de stock en un archivo de texto con un formato inconsistente. Necesitas procesar estos datos para generar un informe de discrepancias críticas en formato CSV que el equipo de almacén pueda importar en Excel.

## Datos de entrada

```
$movimientosCrudos = @"
[LOG-OK] SKU:A199 :: 2024.01.10_08:00 :: Item:Smartphone_X :: Qty:50 :: Status:In_Stock
[LOG-ALERT] SKU:B250 :: 10-01-2024 09:15 :: Item:LAPTOP-PRO :: Qty:-5 :: Status:Damaged
[LOG-OK] SKU:C312 :: 2024/01/10_10:30 :: Item:tablet_air :: Qty:120 :: Status:In_Stock
[LOG-CRIT] SKU:D400 :: 11/01/2024_11:45 :: Item:UNKNOWN_ITEM :: Qty:0 :: Status:Out_Of_Order
"@
```

## Requisitos

- Filtrado de seguridad: ignora todos los registros que tengan el nivel [LOG-OK]. Solo procesa ALERT y CRIT.
- Normalización de nombres:
    - Todos los nombres de Item deben estar en MAYÚSCULAS.
    - Si el item es “UNKNOWN_ITEM”, debe renombrarse automáticamente a “PENDING_REVIEW”.
- Normalización de fechas: todas las fechas (sin importar si usan puntos, guiones o barras) deben transformarse al formato estándar dd/MM/yyyy HH:mm.
- Cálculo de prioridad:
    - Si el status es Damaged, añade una columna llamada ActionRequired con el valor Repair.
    - Si el status es Out_Of_Order, el valor debe ser Replace.
- Salida: genera una lista de [PSCustomObject] y expórtala a un archivo llamado reporte_inventario.csv.

## Script

```
$movimientosCrudos = @"
[LOG-OK] SKU:A199 :: 2024.01.10_08:00 :: Item:Smartphone_X :: Qty:50 :: Status:In_Stock
[LOG-ALERT] SKU:B250 :: 10-01-2024 09:15 :: Item:LAPTOP-PRO :: Qty:-5 :: Status:Damaged
[LOG-OK] SKU:C312 :: 2024/01/10_10:30 :: Item:tablet_air :: Qty:120 :: Status:In_Stock
[LOG-CRIT] SKU:D400 :: 11/01/2024_11:45 :: Item:UNKNOWN_ITEM :: Qty:0 :: Status:Out_Of_Order
"@ -split "`r`n"

$objetos = foreach ( $linea in $movimientosCrudos){

    #Si empeza por [LOG-OK] nos lo saltamos usando un if
    if ( $linea.StartsWith("[LOG-OK]")){ continue }

    #Dividimos cada linea en partes separadas por '::'
    $partes = $linea -split"::"

    #Cogemos el nivel de importancia y el numero SKU
    $Severity = $partes[0].Split(']')[0].Replace('[', '').Split("-")[1].Trim()
    $SKU = $partes[0].Split(':')[1].Trim()

    #Pasamos la fecha a un formato limpio
    $fechaLimpia = $partes[1].Replace('_', ' ').Replace('-', '/').Replace('.', '/')
    $timeStamp = (Get-Date $fechaLimpia).ToString("dd/MM/yyyy HH:mm")

    #Seleccionamos los items
    $item = $partes[2].Split(':')[1].Trim().ToUpper()
    #Si el item es unknown le colocamos un valor diferente
    if ( $item -eq "UNKNOWN_ITEM" ) { $item = "PENDING_REVIEW" }

    #Cogemos el valor qty
    $qty = $partes[3].Split(':')[1].Trim()

    #Cogemos el valor Status
    $status = $partes[4].Split(':')[1].Trim()

    #Si el valor es Damaged o Out_Of_Order guardaremos el valor para una nueva columna
    if ( $status -eq "Damaged" ) { $accionRequerida = "Repair" }
    elseif ( $status -eq "Out_Of_Order" ) { $accionRequerida = "Replace" }
    else { 
        $accionRequerida = ""
    }

    [PSCustomObject]@{
        Fecha    =   $timeStamp
        Severity =   $Severity
        SKU      =   $SKU
        Item     =   $item
        Qty      =   $qty
        Status   =   $status
        ActionRequired = $accionRequerida
    }
}

$objetos | Export-Csv -Path "reporte_inventario.csv"
$objetos | Format-Table -AutoSize
```

## Resultado

```
SKU  Fecha            Item           Cantidad Estado       ActionRequired
---  -----            ----           -------- ------       --------------
B250 10/01/2024 09:15 LAPTOP-PRO     -5       Damaged      Repair        
D400 11/01/2024 12:45 PENDING_REVIEW 0        Out_Of_Order Replace       
```